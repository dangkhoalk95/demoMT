<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Example projects and demos: ble_mesh_vendor_device</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="airoha.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Example projects and demos
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="modules.html"><span>Project&#160;user's&#160;guide</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__mt7697__hdk__apps__ble__mesh__vendor__device.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">ble_mesh_vendor_device<div class="ingroups"><a class="el" href="group__mt7697__hdk.html">mt7697_hdk</a> &raquo; <a class="el" href="group__mt7697__hdk__apps.html">apps</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<dl class="section user"><dt>Overview</dt><dd><ul>
<li>Application description<ul>
<li>This is a reference application to show the Bluetooth mesh vendor device feature of the LinkIt 7697 HDK through the following:<ul>
<li>How to use the Bluetooth mesh device functions.</li>
</ul>
</li>
</ul>
</li>
<li>Application features<ul>
<li>Act as a Bluetooth low-energy (LE) device with mesh features. All Bluetooth Mesh Command Line Interface (CLI) commands are supported in this project.</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Hardware and software environment</dt><dd><ul>
<li>Supported platform<ul>
<li>MediaTek LinkIt 7697 HDK</li>
</ul>
</li>
<li>HDK switches and pin configuration<ul>
<li>J36 provides the pins for GPIOs, PWMs, SPI master chip select 0, SPI master, and UART1 RX/TX.</li>
<li>J35 provides the pins for GPIOs, PWMs, UART2 RX/TX, UART1 RTS/CTS, SPI master chip select 1, IR TX, and IR RX.</li>
<li>J34 provides the pins for GPIOs, PWMs, UART2 RTS/CTS, I2S, SPI slave, and I2C0.</li>
<li>J33 provides the pins for GPIOs, PWMs, I2C0, and ADC0~3.</li>
<li>J32 provides the pins for GND, 5V, 3.3V, and the reset pin.</li>
<li>J25 sets the HDK to either Flash Normal mode or Flash Recovery mode. To update the firmware on the LinkIt 7697 HDK:<ul>
<li>Set the Jumper J25 to FLASH Recovery mode; Jumpers J23, J26, J27, and J30 must be on.</li>
<li>In this mode, if the power is on, the board loads the ROM code and starts the ATE Daemon or Firmware Upgrade Daemon according to the MT76x7 Flash Tool's behavior on the PC. To run the project on the LinkIt 7697 HDK:</li>
<li>Set the Jumper J25 off to switch to FLASH Normal mode; Jumpers J23, J26, J27, and J30 must be on.</li>
<li>In this mode, if the power is on, the board loads firmware from the flash and reboots.</li>
</ul>
</li>
<li>There are three buttons on the board:<ul>
<li>RST - Reset</li>
<li>EINT - External interrupt</li>
<li>RTC_INT - RTC interrupt</li>
</ul>
</li>
</ul>
</li>
<li>Environment configuration<ul>
<li>A serial tool is required, such as TeraTerm for UART logging.</li>
<li>COM port settings -baudrate: 115200, data bits: 8, stop bit: 1, parity: none, and flow control: off.</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Directory contents</dt><dd><ul>
<li>This file<ul>
<li><b>readme.txt</b>. Overview of the project</li>
</ul>
</li>
<li>Source and header files<ul>
<li><b>src/bt/bt_init.c</b>: Bluetooth memory initialization and task creation.</li>
<li><b>src/bt/bt_app_callback_handler.c</b>: Implement the Bluetooth event handler.</li>
<li><b>src/bt/bt_connection_info.c</b>: Store the Bluetooth bonding info and connection info.</li>
<li><b>src/bt/bt_gatt_service.c</b>: Implement the Bluetooth GATT service.</li>
<li><b>src/bt/hci_log.c</b>: Bluetooth HCI log file. The user must initiate the UART port for HCI logging.</li>
<li><b>src/mesh/mesh_app_vendor_device.c</b>: Bluetooth mesh CLI command handler for mesh vendor device. It is only used by ble_mesh_vendor_device project.</li>
<li><b>src/mesh/mesh_app_vendor_device_msg_handler.c</b>: Bluetooth mesh CLI command handler for mesh vendor device. It is only used by ble_mesh_vendor_device project.</li>
<li><b>src/mesh/mesh_app_vendor_device_pwm.c</b>: Bluetooth mesh CLI command handler for mesh vendor device. It is only used by ble_mesh_vendor_device project.</li>
<li><b>src/mesh/mesh_app_switch.c</b>: Bluetooth mesh CLI command handler for mesh switch device. It is only used by ble_mesh_switch project.</li>
<li><b>src/mesh/mesh_app_util.c</b>: Bluetooth mesh util file.</li>
<li><b>src/mesh/mesh_app_gateway_demo.c</b>: WI-FI and bluetooth gateway function demo. The LinkIt 7697 HDK connects to the same WI-FI AP as the PC, then the user can input commands via the UART tool on the PC to control the LinkIt 7697 HDK. It is only used by ble_mesh_switch project.</li>
<li><b>src/cli_cmds.c</b>: CLI commands of this project.</li>
<li><b>src/cli_def.c</b>: CLI initialization sequence code.</li>
<li><b>src/ept_eint_var.c</b>: EINT configuration file generated by Easy Pinmux Tool (EPT). Please do not make any changes to this file.</li>
<li><b>src/ept_gpio_var.c</b>: GPIO configuration file generated by Easy Pinmux Tool (EPT). Please do not make any changes to this file.</li>
<li><b>src/main.c</b>: Entry point of the application program.</li>
<li><b>src/sys_init.c</b>: Aggregated initialization routines.</li>
<li><b>src/system_mt7687.c</b>: MT7697 system clock configuration file.</li>
<li><b>src/wifi_lwip_helper.c</b>: lwIP configuration.</li>
<li><b>src/wifi_nvdm_config.c</b>: Default user configuration file.</li>
<li><b>inc/bt/bt_init.h</b>: Declare the Bluetooth task create API.</li>
<li><b>inc/bt/hci_log.h</b>: Declare the Bluetooth HCI log API.</li>
<li><b>inc/bt/project_config.h</b>: Declare the Bluetooth configuration of the memory and link number.</li>
<li><b>inc/bt/bt_gatt_service.h</b>: Declare the Bluetooth GATT service API.</li>
<li><b>inc/bt/bt_connection_info.h</b>: Declare the Bluetooth connection info API.</li>
<li><b>inc/bt/bt_app_callback_handler.h</b>: Declare the Bluetooth APP callback handler API.</li>
<li><b>inc/mesh/mesh_app.h</b>: Declare the Bluetooth mesh APP instructure.</li>
<li><b>inc/mesh/mesh_app_util.h</b>: Declare the Bluetooth mesh APP util API.</li>
<li><b>inc/cli_cmds.h</b>: Declare the reference point of CLI commands of cli_cmds.c. To be used by cli_def.c.</li>
<li><b>inc/default_config.h</b>: Default user configuration.</li>
<li><b>inc/ept_eint_drv.h</b>: The EINT configuration file generated by Easy Pinmux Tool (EPT). Please do not make any changes to this file.</li>
<li><b>inc/ept_gpio_drv.h</b>: The GPIO configuration file generated by Easy Pinmux Tool (EPT). Please do not make any changes to this file.</li>
<li><b>inc/flash_map.h</b>: MT7697 memory layout symbol file.</li>
<li><b>inc/FreeRTOSConfig.h</b>: MT7697 FreeRTOS configuration file.</li>
<li><b>inc/task_def.h</b>: Define the task stack size, queue length, project name, and priority for the application to create tasks.</li>
<li><b>inc/hal_feature_config.h</b>: MT7697 HAL API feature configuration file.</li>
<li><b>inc/lwipopts.h</b>: lwIP configuration.</li>
<li><b>inc/project_config.h</b>: Define the maximum number of Bluetooth connections and timer and define the buffersize of the TX/RX, timer, and connection.</li>
<li><b>inc/sys_init.h</b>: Prototype declaration for the system configuration.</li>
<li><b>inc/task_def.h</b>: The configuration of running tasks of the project.</li>
<li><b>inc/wifi_lwip_helper.h</b>: Prototype declaration for Wi-Fi Lwip.</li>
<li><b>inc/wifi_nvdm_config.h</b>: Prototype declaration for the default user configuration file.</li>
</ul>
</li>
<li>Project configuration files using GCC.<ul>
<li><b>GCC/Makefile</b>.: GNU Makefile for this project.</li>
<li><b>GCC/feature.mk</b>: Generic feature options configuration file.</li>
<li><b>GCC/feature_ble_mesh_switch.mk</b>: Generic feature options configuration file for BLE mesh switch project.</li>
<li><b>GCC/mt7687_flash.ld</b>: Linker script.</li>
<li><b>GCC/startup_mt7687.s</b>: MT7697 startup file.</li>
<li><b>GCC/syscalls.c</b>: MT7697 syscalls implementation.</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Run the application</dt><dd><ul>
<li>Build the example project with the command "./build.sh mt7697_hdk
    ble_mesh_vendor_device" from the SDK root folder and download the binary file to the LinkIt 7697 development board.</li>
<li>Reboot the HDK. The console shows the "FreeRTOS Running" message to indicate that the HDK is booting up.</li>
<li>Use '?' and ENTER to query the available command line options. Note that the command line options are still under development and subject to change without notice.</li>
<li>Reference applications run and the LinkIt 7697 HDK can join the Bluetooth LE mesh that is enabled nearby.</li>
<li>Example 1. Using the BLE mesh feature<ul>
<li>This example creates a BLE mesh device with six mesh elements. There are five types of models that are covered in these elements: configuration server model; health server model; generic on/off server model; vendor server model; and lighting server model. The structure of this vendor device is shown below:<ul>
<li>It supports Relay feature, Proxy feature and Friend feature.</li>
<li>It has six elements and each element has different models, as shown below:<ul>
<li>Element 0 includes three SIG models: "Configuration Server"; "Health 
          Server"; "Generic OnOff Server"; and one vendor model with ID 0x002A.</li>
<li>Element 1 includes nine SIG models: "Generic Level Server"; "Generic OnOff 
          Server"; "Generic Default Transition Time Server"; "Generic Power OnOff 
          Server"; "Generic Power OnOff Setup Server"; "Light Lightness Server"; "Light 
          Ligntness Setup Server"; "Light CTL Server"; and "Light CTL Setup Server".</li>
<li>Element 2 includes two SIG models: "Generic OnOff Server"; and "Light CTL Temperature Server".</li>
<li>Element 3 includes nine SIG models: "Generic Level Server"; "Generic OnOff 
          Server"; "Generic Default Transition Time Server"; "Generic Power OnOff 
          Server"; "Generic Power OnOff Setup Server"; "Light Lightness Server"; "Light 
          Ligntness Setup Server"; "Light HSL Server"; and "Light HSL Setup Server".</li>
<li>Element 5 includes two SIG models: "Generic OnOff Server"; and "Light HSL HUE Server".</li>
<li>Element 5 includes two SIG models: "Generic OnOff Server"; and "Light HSL Saturation Server".</li>
</ul>
</li>
<li>Element 0 is addressed using the first unicast address assigned to the node during provisioning. Other elements are addressed using the subsequent addresses. For example, if the unicast of the node is 0004, element 0 is addressed 0004, and element 1 is addressed 0005.</li>
</ul>
</li>
<li>The mesh feature is enabled when Bluetooth successfully powers on. A similar log is written to the output: <div class="fragment"><div class="line">[T: xxxx M: mesh_app C: info F: bt_mesh_app_event_callback L: 272]: BLE_MESH_EVT_INIT_DONE</div></div><!-- fragment --></li>
<li>When this device is successfully added to a mesh network. A similar log is written to the output: <div class="fragment"><div class="line">[T: xxxx M: mesh_app C: info F: bt_mesh_app_event_callback L: 287]: BLE_MESH_EVT_PROV_DONE</div></div><!-- fragment --></li>
<li>If the device receives a message from a different device using the same mesh network and application key, a similar log is written to the output: <div class="fragment"><div class="line">Receive a SIG message in which xxxx is the SIG message <span class="keywordtype">id</span>.</div><div class="line">[Mesh]rece SigMsg[xxxx]</div><div class="line">If the SIG message is to turn on/off LED on <span class="keyword">this</span> device.</div><div class="line">[Mesh]led is on or [Mesh]led is off</div><div class="line">Receive a vendor message in which xx is the company <span class="keywordtype">id</span> and xxxx is the vendor message <span class="keywordtype">id</span>.</div><div class="line">[Mesh]rece VenrodMsg[xx:xxxx]      </div></div><!-- fragment --></li>
<li>To delete the mesh data, use the command "mesh delete". It takes effect after rebooting again. </li>
</ul>
</li>
</ul>
</dd></dl>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Nov 19 2018 03:06:29 for Example projects and demos by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
